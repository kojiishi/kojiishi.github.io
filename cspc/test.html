<!DOCTYPE html>
<html lang="ja">
<meta charset="utf-8">
<style>
@font-face {
  font-family: test;
  src: url(SourceHanSerifCSP-Heavy.otf);
}
.vert {
  writing-mode: vertical-rl;
}
.fwid {
  font-variant-east-asian: full-width;
}
#ui {
  font-family: Arial, Helvetica, sans-serif;
  writing-mode: horizontal-tb;
  position: fixed; left: 0; top: 0;
  padding: .5em;
  z-index: 1;
  background: rgba(255, 255, 255, .9);
  border: gray 2px solid;
  width: 100%;
}
#ui > div > label {
  display: inline-block;
  width: 8ch;
}
#ui > div > input[type=text] {
  width: 30em;
}
#ui .note {
  font-family: 'Times New Roman', Times, serif;
}
#container {
  font-feature-settings: 'kern' 0, 'vkrn' 0, 'chws' 0, 'vchw' 0, 'cspc' 0, 'vcsp' 0;
  margin-top: 6em;
  column-width: 8em;
  font-family: test;
  font-size: 20px;
}
h2 {
  font-size: 1em;
  margin: 0;
}
ol {
  margin: 0;
  padding-left: 50px;
}
li {
  position: relative;
}
.normal {
  color: lightblue;
  border: lightblue 1px solid;
}
.ref {
  position: absolute; left: 0; top: 0;
  color: pink;
}
.test {
  font-feature-settings: 'chws' 1;
  position: absolute; left: 0; top: 0;
  border: blue 1px solid;
}
.vert .test {
  font-feature-settings: 'vchw' 1;
}
.hwid {
  font-feature-settings: 'halt' 1;
}
</style>
<body>
  <div id=ui>
    <div><label>Open: </label><input id=open type=text></div>
    <div><label>Close: </label><input id=close type=text></div>
    <div><label>Middle: </label><input id=middle type=text></div>
    <input id=create type=button value="Update Tests">
    <input id=vert type=checkbox
      onchange="document.documentElement.classList.toggle('vert')">
    <label for=vert>Vertical</label>
    <input id=fwid type=checkbox
      onchange="document.documentElement.classList.toggle('fwid')">
    <label for=fwid>Full-width</label>
    <span class="note">The <span style="color: lightblue">lightblue text</span> is without the feature.</span>
  </div>
  <div id=container></div>
<script>
class Spacing {
  constructor() {
    this.initUI();
    this.initLists();
  }

  initUI() {
    this.container = document.getElementById('container');
    document.getElementById('create').addEventListener('click', () => {
      this.updateFromUI();
      this.container.textContent = '';
      this.createTests();
    });
  }

  initLists() {
    this.open = '\u2018\u201C\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\u301A\u301D\uFF08\uFF3B\uFF5B\uFF5F';
    this.close = '\u2019\u201D\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\u301B\u301E\u301F\uFF09\uFF3D\uFF5D\uFF60';
    this.middle = '\u00B7\u2027\u30FB'
    this.space = '\u3000';
    this.period_comma = '\u3001\u3002\uFF0C\uFF0E';
    this.colon = '\uFF01\uFF1A\uFF1B\uFF1F';
    // For Japanese:
    this.close += this.period_comma;
    this.middle += this.colon;
    document.getElementById('open').value = this.open;
    document.getElementById('close').value = this.close;
    document.getElementById('middle').value = this.middle;
  }

  updateFromUI() {
    this.open = document.getElementById('open').value;
    this.close = document.getElementById('close').value;
    this.middle = document.getElementById('middle').value;
  }

  createTests() {
    let container = this.createSection('Open+Open');
    this.createCombinations(container, this.open, this.open, false, true);
    container = this.createSection('Open+Close');
    this.createCombinations(container, this.close, this.open, false, true);
    container = this.createSection('Close+Close');
    this.createCombinations(container, this.close, this.close, false, true);
    container = this.createSection('Space');
    this.createCombinations(container, this.close, this.space, true, false);
    this.createCombinations(container, this.space, this.open, false, true);
    container = this.createSection('Middle');
    this.createCombinations(container, this.middle, this.open, false, true);
    this.createCombinations(container, this.close, this.middle, false, true);
  }

  createSection(title) {
    let section = document.createElement('section');
    let heading = document.createElement('h2');
    heading.textContent = title;
    section.appendChild(heading);
    let list = document.createElement('ol');
    section.appendChild(list);
    this.container.appendChild(section);
    return list;
  }

  createCombinations(container, list0, list1, half0, half1) {
    for (let ch0 of list0) {
      for (let ch1 of list1) {
        this.createTest(container, ch0, ch1, half0, half1);
      }
    }
  }

  createTest(parent, ch0, ch1, half0, half1) {
    let item = document.createElement('li');

    let normal = document.createElement('span');
    normal.classList.add('normal');
    normal.textContent = 'あ' + ch0 + ch1 + 'あ';
    item.appendChild(normal);

  /*
    let ref = document.createElement('span');
    ref.classList.add('ref');
    ref.innerHTML = 'あ' +
                    (half0 ? '<span class=hwid>' + ch0 + '</span>' : ch0) +
                    (half1 ? '<span class=hwid>' + ch1 + '</span>' : ch1) +
                    'あ';
    item.appendChild(ref);
  */

    let test = document.createElement('span');
    test.classList.add('test');
    test.textContent = 'あ' + ch0 + ch1 + 'あ';
    item.appendChild(test);

    parent.appendChild(item);
  }

  runTests() {
    let elements = document.querySelectorAll('.cspc');
    let range = document.createRange();
    for (let i = 0; i < elements.length; i++) {
      let e = elements[i];
      range.selectNodeContents(e.firstChild);
      let bounds = range.getBoundingClientRect();
      console.log(bounds.width);
    }
  }
}

let spacing = new Spacing();
spacing.createTests();
spacing.runTests();
</script>
</body>
</html>
